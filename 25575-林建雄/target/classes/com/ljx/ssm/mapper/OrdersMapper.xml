<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ljx.ssm.mapper.OrdersMapper">

    <sql id="whereClause">
        <!-- if标签：可以对输入的参数进行判断 -->
        <!-- test:指定判断表达式 -->
        <if test="user != null">
            <if test="user.username != null and user.username != ''">
                AND username LIKE '%${user.username}%'
            </if>
            <if test="user.sex != null and user.sex != ''">
                AND sex = #{user.sex}
            </if>
        </if>

        <if test="idList != null">
            <!-- AND id IN (#{id},#{id},#{id}) -->

            <!-- collection：表示pojo中集合属性的属性名称 -->
            <!-- item:为遍历出的结果声明一个变量名称 -->
            <!-- open：遍历开始时，需要拼接的字符串 -->
            <!-- close:遍历结束时，需要拼接的字符串 -->
            <!-- separator：遍历中间需要拼接的连接符 -->
            AND id IN
            <foreach collection="idList" item="id" open="(" close=")"
                     separator=",">
                #{id}
            </foreach>
        </if>
    </sql>

    <resultMap type="com.ljx.ssm.po.Orders" id="OrdersExtRstMap">
        <id column="id" property="id" />
        <result column="user_id" property="userId" />
        <result column="number" property="number" />

        <association property="user" javaType="com.ljx.ssm.po.User">
            <id column="user_id" property="id" />
            <result column="username" property="username" />
            <result column="address" property="address" />
        </association>
        <!-- 订单明细信息（一对多） -->
        <collection property="detailList" ofType="com.ljx.ssm.po.Orderdetail">
            <id column="detailId" property="id" />
            <result column="items_id" property="itemsId" />
            <result column="items_num" property="itemsNum" />
            <!-- 商品信息（一对一） -->
            <association property="items" javaType="items">
                <id column="items_id" property="id" />
                <result column="name" property="name" />
                <result column="price" property="price" />
            </association>
        </collection>
    </resultMap>

    <!-- 多对多 -->
    <select id="findOrdersExts" resultMap="OrdersExtRstMap">
		SELECT
		orders.`id`,
		orders.`user_id`,
		orders.`number`,
		user.`username`,
		user.`sex`,
		orderdetail.`id` detailId,
		orderdetail.`items_id`,
		orderdetail.`items_num`,
		items.`name`,
		items.`price`
		FROM
		orders,
		USER,
		orderdetail,
		items
		WHERE orders.`user_id` = user.`id`
		AND orders.`id` =
		orderdetail.`orders_id`
		AND orderdetail.`items_id` = items.`id`
	</select>
</mapper>

