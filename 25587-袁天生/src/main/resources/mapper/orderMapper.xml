<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.yts.mapper.OrdersMapper">

    <resultMap id="BaseResultMap" type="OrdersExt">
        <id column="id" javaType="INTEGER"/>
        <result column="user_id" jdbcType="VARCHAR" property="user_id"/>
        <result column="number" jdbcType="VARCHAR" property="number"/>
        <result column="note" jdbcType="VARCHAR" property="note"/>
        <result column="createtime" property="createtime"/>
        <result column="username" jdbcType="VARCHAR" property="username"/>
        <result column="address" jdbcType="VARCHAR" property="address"/>
<!--        <association property="user" javaType="User">-->
<!--            <id column="user_id" property="id"/>-->
<!--            <result column="username" property="username"/>-->
<!--            <result column="address" property="address"/>-->
<!--        </association>-->

    </resultMap>

    <select id="findOrdersExts" resultMap="BaseResultMap" parameterType="OrdersExt">
        select *
        from
        orders o
        INNER JOIN orderdetail od
        ON o.id = od.orders_id
        inner join items i on i.id = od.items_id
        <where>
            <if test="number !=null">
                and o.number=#{number}
            </if>

            <if test="username !=null">
                and i.name=#{username}
            </if>

            <if test="createtimeStart !=null">
                <![CDATA[   and DATE_FORMAT(createtime, '%Y-%m-%d')>=  DATE_FORMAT(#{createtimeStart}, '%Y-%m-%d')   ]]>
            </if>
            <if test="createtimeEnd !=null">
                <![CDATA[  and DATE_FORMAT(createtime, '%Y-%m-%d') <= DATE_FORMAT(#{createtimeEnd}, '%Y-%m-%d')    ]]>
            </if>
            <if test="priceStart !=null">
                <if test="priceStart !=null and priceStart !=''">
                    and i.price >= #{priceStart}
                </if>
            </if>
            <if test="priceEnd !=null">
                <if test="priceEnd !=null and priceEnd !=''">
                    and i.price = #{priceEnd}
                </if>
            </if>
        </where>

    </select>


</mapper>
